# Import the Active Directory module
Import-Module ActiveDirectory

# Get all domain-joined servers
$servers = Get-ADComputer -Filter {OperatingSystem -like "*Server*"} -Property Name | Select-Object -ExpandProperty Name

# Create a list to store results
$results = @()

# Loop through each server to check if IPv6 is enabled
foreach ($server in $servers) {
    try {
        $networkAdapters = Invoke-Command -ComputerName $server -ScriptBlock {
            Get-NetAdapterBinding -ComponentID ms_tcpip6 | Select-Object Name, Enabled
        }
        
        foreach ($adapter in $networkAdapters) {
            $results += [PSCustomObject]@{
                Server = $server
                Adapter = $adapter.Name
                IPv6Enabled = $adapter.Enabled
            }
        }
    } catch {
        #Write-Warning "Failed to query $server: $_"
        #Write-Warning "Failed to query $server: $($_)"
        $results += [PSCustomObject]@{
            Server = $server
            Adapter = "N/A"
            IPv6Enabled = "Failed to connect"
        }
    }
}

# Output the results
$results | Format-Table -AutoSize

# Optionally, export the results to a CSV file
$results | Export-Csv -Path "c:\Path\Pv6Status.csv" -NoTypeInformation
